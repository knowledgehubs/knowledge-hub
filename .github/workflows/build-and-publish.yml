name: ğŸ—ï¸ Build Hugo and Publish to GitHub Pages (Unified)

on:
  schedule:
    # ğŸ’¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©: ÙŠØ¹Ù…Ù„ ÙŠÙˆÙ…ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ø³Ø§Ø¹Ø© 03:00 ØµØ¨Ø§Ø­Ø§Ù‹ Ø¨ØªÙˆÙ‚ÙŠØª UTC
    - cron: '0 3 * * *'
  
  workflow_dispatch:
    # ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙˆØ¶Ø¹
    inputs:
      mode:
        description: 'SYSTEM_MODE: LIVE or TEST'
        required: true
        default: 'LIVE'
        type: choice
        options:
          - LIVE
          - TEST
          
jobs:
  build:
    runs-on: ubuntu-latest
    
    # ğŸ’¡ Ø¥Ø°Ù† Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø¶Ø±ÙˆØ±ÙŠ Ù„Ø®Ø·ÙˆØ© git push Ø§Ù„Ù„Ø§Ø­Ù‚Ø©
    permissions:
      contents: write
      
    env:
      # ğŸ’¡ ØªØºÙŠÙŠØ± Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¥Ù„Ù‰ LIVE
      SYSTEM_MODE: ${{ github.event.inputs.mode || 'LIVE' }} 
      
    steps:
      - name: â¬‡ï¸ Checkout Repository (Full History)
        # Token Ø¶Ø±ÙˆØ±ÙŠ Ù„Ø¬Ù„Ø¨ Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ ÙˆØ¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù€ Push
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }} 
          
      # ğŸ’¡ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: Ø¬Ù„Ø¨ Ù‚Ø§Ù„Ø¨ PaperMod ÙƒÙ…Ù„Ù Ø¹Ø§Ø¯ÙŠ (Ø£ÙØ¶Ù„ Ù…Ù† submodule)
      - name: â¬‡ï¸ Clone Theme PaperMod
        run: git clone https://github.com/adityatelange/hugo-PaperMod.git themes/PaperMod

      - name: ğŸ—ï¸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: âš™ï¸ Set Git User for Commit
        run: |
          git config --global user.email "knowledgehub-bot@users.noreply.github.com"
          git config --global user.name "Knowledge Hub Automation Bot"

      - name: ğŸš€ Run Generator Script
        run: python content-engine/generator.py
        env:
          SYSTEM_MODE: ${{ env.SYSTEM_MODE }}
          
      - name: â¬†ï¸ Push Content Commit (If New Content Generated)
        if: env.SYSTEM_MODE == 'LIVE'
        run: |
          git push

      - name: ğŸ› ï¸ Setup Hugo
        uses: peaceiris/actions-hugo@v3
        with:
          hugo-version: 'latest'

      - name: âš™ï¸ Build Hugo Site
        # Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø¢Ù† Ø³ØªØ³ØªØ®Ø¯Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯ PaperMod
        run: hugo --minify

      - name: ğŸš€ Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        if: success()  
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./public
          publish_branch: gh-pages
          cname: ''
