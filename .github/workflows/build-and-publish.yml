name: ğŸ—ï¸ Build Hugo and Publish to GitHub Pages (Unified)

on:
  schedule:
    # Schedule the job to run once daily (00:00 UTC)
    - cron: '0 0 * * *'
  
  workflow_dispatch:
    # Allows manual trigger and setting the mode
    inputs:
      mode:
        description: 'SYSTEM_MODE: LIVE or TEST'
        required: true
        default: 'TEST'
        type: choice
        options:
          - LIVE
          - TEST
          
jobs:
  build:
    runs-on: ubuntu-latest
    
    # ğŸ’¡ Ø§Ù„Ø­Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: Ù…Ù†Ø­ Ø§Ù„Ù€ Token Ø¥Ø°Ù† Ø§Ù„ÙƒØªØ§Ø¨Ø© Ù„Ù„Ù…Ø­ØªÙˆÙ‰
    permissions:
      contents: write
      
    # ØªØ¹Ø±ÙŠÙ Ù…ØªØºÙŠØ± Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø³Ù„ÙˆÙƒ Python
    env:
      SYSTEM_MODE: ${{ github.event.inputs.mode || 'LIVE' }} 
      
    steps:
      - name: â¬‡ï¸ Checkout Repository (Full History)
        # ÙŠØ¬Ø¨ Ø§Ø³ØªØ®Ø¯Ø§Ù… token Ù„ØªÙ†ÙÙŠØ° git push Ù„Ø§Ø­Ù‚Ù‹Ø§
        uses: actions/checkout@v4
        with:
          submodules: true
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }} 

      - name: ğŸ—ï¸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: âš™ï¸ Set Git User for Commit
        # Ø¥Ø¹Ø¯Ø§Ø¯ Ù‡ÙˆÙŠØ© Ø§Ù„Ù€ Commit Ø§Ù„ØªÙŠ Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© generator.py
        run: |
          git config --global user.email "knowledgehub-bot@users.noreply.github.com"
          git config --global user.name "Knowledge Hub Automation Bot"

      - name: ğŸš€ Run Generator Script
        # ÙŠÙ‚ÙˆÙ… Ø¨ØªÙˆÙ„ÙŠØ¯ 5 Ù…Ù‚Ø§Ù„Ø§ØªØŒ ØªØ­Ø¯ÙŠØ« Ù…Ù„ÙØ§Øª CSVØŒ ÙˆØ¥Ù†Ø´Ø§Ø¡ Git Commit Ù…Ø­Ù„ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù† LIVE
        run: python content-engine/generator.py
        env:
          SYSTEM_MODE: ${{ env.SYSTEM_MODE }}
          
      - name: â¬†ï¸ Push Content Commit (If New Content Generated)
        # ÙŠØ¯ÙØ¹ Ø§Ù„Ù€ Commit Ø§Ù„Ù…Ø­Ù„ÙŠ Ø§Ù„Ø°ÙŠ Ø£Ù†Ø´Ø£Ù‡ generator.py Ø¥Ù„Ù‰ Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø¨Ø¹ÙŠØ¯ (main)
        if: env.SYSTEM_MODE == 'LIVE'
        run: |
          # Ù†Ø³ØªØ®Ø¯Ù… GITHUB_TOKEN Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø¢Ù…Ù†Ø©
          git push

      - name: ğŸ› ï¸ Setup Hugo
        uses: peaceiris/actions-hugo@v3
        with:
          hugo-version: 'latest'

      - name: âš™ï¸ Build Hugo Site
        run: hugo --minify

      - name: ğŸš€ Deploy to GitHub Pages
        # Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¯ÙØ¹ Ù†Ø§Ø¬Ø­Ø§Ù‹ (Ø£Ùˆ ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±)ØŒ ÙŠØªÙ… Ø§Ù„Ù†Ø´Ø±
        uses: peaceiris/actions-gh-pages@v4
        if: success() 
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./public
          publish_branch: gh-pages
          cname: ''
